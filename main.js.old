
function init() {

// Initial setup
const main = document.querySelector('main');

/** @type { HTMLElement[] } */
// @ts-ignore
const pages = Array.from(main.children);

const dialog = document.createElement('dialog');

/** @type { HTMLElement } */
const nav_entries = document.querySelector('#navbar-entries');

// Get the initial visible page
let current_page = pages.find(
    page => !page.hidden
);

// Set up hash handling
window.addEventListener('hashchange', on_hashchange);
on_hashchange(false);

// Set up card click handlers
(function() {

    /** @type { HTMLElement[] } */
    const cards = Array.from(main.querySelectorAll('.card'));
    const clickable_cards = cards.filter(card => card.querySelector('.content') !== null);

    for (const card of clickable_cards) {

        function view_this_card() { 
            view_card(card); 
        }

        card.addEventListener('click', view_this_card);
        card.addEventListener('keypress', handle_enter(view_this_card));
    }

})();

/**
 * Handler for hashchange to change page
 */
function on_hashchange(smooth = true) {

    const newloc = window.location.hash.slice(1);
    const new_page = pages.find( page => page.id === newloc );

    if ( new_page === undefined ) {
        return;
    }

    if (smooth) {
        new_page.scrollIntoView({
            behavior: 'smooth'
        });
    }

    visit_page(new_page);
}


}
